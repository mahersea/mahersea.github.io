<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plasma Physics Simulator</title>
  <meta name="description" content="Interactive plasma physics simulation with electric fields, magnetic confinement, and particle dynamics">
  <style>
    body { 
      margin: 0; 
      background: #000813; 
      color: #ffffff;
      font-family: Arial, sans-serif; 
      text-align: center; 
    }
    canvas { 
      display: block; 
      margin: 20px auto; 
      background: #001122; 
      border: 2px solid #334455;
      box-shadow: 0 0 30px rgba(50, 150, 255, 0.4);
      cursor: crosshair;
    }
    .controls { 
      margin: 10px auto; 
      color: #ffffff;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      max-width: 1000px;
    }
    .control-group {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(30, 60, 100, 0.4);
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(100, 150, 200, 0.3);
    }
    .control-section {
      background: rgba(20, 40, 80, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin: 10px;
      border: 1px solid rgba(100, 150, 200, 0.4);
    }
    .control-section h3 {
      margin: 0 0 10px 0;
      color: #66ccff;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    button {
      background: #224477;
      color: #fff;
      border: 1px solid #446699;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
    }
    button:hover {
      background: #336688;
    }
    button.active {
      background: #4488cc;
      box-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
    }
    input[type="range"] {
      background: #334477;
      accent-color: #66ccff;
      width: 100px;
    }
    label {
      font-size: 12px;
      color: #ccddff;
      min-width: 80px;
    }
    .value-display {
      font-family: monospace;
      font-size: 12px;
      color: #66ccff;
      min-width: 40px;
      text-align: center;
      font-weight: bold;
    }
    .info {
      max-width: 800px;
      margin: 0 auto 15px;
      font-size: 14px;
      color: #aabbdd;
      line-height: 1.4;
    }
    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px;
      font-size: 12px;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(50, 50, 100, 0.3);
      padding: 4px 8px;
      border-radius: 4px;
    }
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .stats {
      background: rgba(10, 20, 40, 0.8);
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 11px;
      border: 1px solid rgba(100, 150, 200, 0.3);
    }
    .temperature-bar {
      width: 100%;
      height: 8px;
      background: linear-gradient(to right, #0066ff, #00ffff, #ffff00, #ff6600, #ff0000);
      border-radius: 4px;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>⚡ Plasma Physics Simulator</h1>
  <div class="info">
    <p>Interactive plasma physics simulation featuring ionized particles, electric fields, magnetic confinement, and collective plasma behavior. Click to place electrodes, drag to create field sources.</p>
  </div>
  
  <div class="legend">
    <div class="legend-item">
      <div class="legend-color" style="background: #ff4444;"></div>
      <span>Protons (H⁺)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #4444ff;"></div>
      <span>Electrons (e⁻)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #44ff44;"></div>
      <span>Alpha Particles (α)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #ffaa00;"></div>
      <span>Heavy Ions</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #66ccff;"></div>
      <span>Electric Field Lines</span>
    </div>
  </div>
  
  <div class="controls">
    <div class="control-section">
      <h3>Plasma Generation</h3>
      <div class="control-group">
        <button id="pauseBtn">Pause</button>
        <button id="clearBtn">Clear Plasma</button>
        <button id="ionizeBtn">Ionize Gas</button>
      </div>
      <div class="control-group">
        <label for="particleDensity">Density:</label>
        <input type="range" id="particleDensity" min="10" max="200" value="50">
        <span class="value-display" id="particleDensityValue">50</span>
      </div>
      <div class="control-group">
        <label for="temperature">Temperature:</label>
        <input type="range" id="temperature" min="1000" max="50000" value="10000">
        <span class="value-display" id="temperatureValue">10000K</span>
      </div>
    </div>
    
    <div class="control-section">
      <h3>Electric Fields</h3>
      <div class="control-group">
        <button id="addElectrodeBtn" class="active">Add Electrode</button>
        <button id="clearElectrodesBtn">Clear Electrodes</button>
      </div>
      <div class="control-group">
        <label for="fieldStrength">Field Strength:</label>
        <input type="range" id="fieldStrength" min="0" max="100" value="30">
        <span class="value-display" id="fieldStrengthValue">30</span>
      </div>
      <div class="control-group">
        <label for="showFieldLines">Show Field Lines:</label>
        <input type="checkbox" id="showFieldLines" checked>
      </div>
    </div>
    
    <div class="control-section">
      <h3>Magnetic Confinement</h3>
      <div class="control-group">
        <button id="magneticBottleBtn">Magnetic Bottle</button>
        <button id="tokamakBtn">Tokamak Mode</button>
        <button id="clearMagneticBtn">Clear Magnetic</button>
      </div>
      <div class="control-group">
        <label for="magneticField">B-Field:</label>
        <input type="range" id="magneticField" min="0" max="100" value="20">
        <span class="value-display" id="magneticFieldValue">20</span>
      </div>
    </div>
    
    <div class="control-section">
      <h3>Plasma Properties</h3>
      <div class="stats">
        <div>Particles: <span id="particleCount">0</span></div>
        <div>Avg Velocity: <span id="avgVelocity">0</span> km/s</div>
        <div>Plasma Frequency: <span id="plasmaFreq">0</span> MHz</div>
        <div>Debye Length: <span id="debyeLength">0</span> μm</div>
        <div>Temperature:</div>
        <div class="temperature-bar"></div>
        <div><span id="tempDisplay">0</span> K</div>
      </div>
    </div>
  </div>
  
  <canvas id="canvas"></canvas>
  
  <script>
    // Canvas setup
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    canvas.width = 1000;
    canvas.height = 700;
    
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    
    // Animation variables
    let animationId;
    let isAnimating = true;
    let time = 0;
    
    // Simulation parameters
    let particleDensity = 50;
    let plasmaTemperature = 10000; // Kelvin
    let electricFieldStrength = 0.3;
    let magneticFieldStrength = 0.2;
    let showFieldLines = true;
    
    // Mouse interaction
    let mouseX = cx;
    let mouseY = cy;
    let mouseDown = false;
    let electrodeMode = true;
    
    // Plasma system
    let particles = [];
    let electrodes = [];
    let fieldLines = [];
    let magneticSources = [];
    
    // Physical constants (scaled for simulation)
    const k_e = 8.99e9; // Coulomb constant (scaled)
    const k_B = 1.38e-23; // Boltzmann constant
    const eV_to_J = 1.602e-19; // electron volt to joules
    const m_e = 9.109e-31; // electron mass
    const m_p = 1.673e-27; // proton mass
    
    // Particle types for plasma
    const plasmaParticleTypes = {
      proton: {
        type: 'proton',
        color: '#ff4444',
        charge: 1,
        mass: 938.3, // MeV/c²
        symbol: 'H⁺',
        size: 2
      },
      electron: {
        type: 'electron', 
        color: '#4444ff',
        charge: -1,
        mass: 0.511, // MeV/c²
        symbol: 'e⁻',
        size: 1
      },
      alpha: {
        type: 'alpha',
        color: '#44ff44',
        charge: 2,
        mass: 3727, // MeV/c²
        symbol: 'α',
        size: 3
      },
      heavyIon: {
        type: 'heavyIon',
        color: '#ffaa00',
        charge: 3,
        mass: 5000, // MeV/c²
        symbol: 'X⁺⁺⁺',
        size: 4
      }
    };
    
    // Particle class for plasma physics
    class PlasmaParticle {
      constructor(x, y, vx, vy, type) {
        this.x = x;
        this.y = y;
        this.vx = vx;
        this.vy = vy;
        this.type = type;
        this.charge = type.charge;
        this.mass = type.mass;
        this.age = 0;
        this.active = true;
        this.trail = [];
        this.collisionCooldown = 0;
        
        // Calculate kinetic energy and thermal velocity
        this.kineticEnergy = 0.5 * this.mass * (this.vx * this.vx + this.vy * this.vy);
        this.thermalVelocity = Math.sqrt(3 * k_B * plasmaTemperature / (this.mass * 1.661e-27)); // scaled
      }
      
      update() {
        if (!this.active) return;
        
        this.age++;
        this.collisionCooldown--;
        
        // Electric field forces from electrodes
        let fx = 0, fy = 0;
        
        electrodes.forEach(electrode => {
          const dx = this.x - electrode.x;
          const dy = this.y - electrode.y;
          const distSq = dx * dx + dy * dy + 100; // avoid singularity
          const dist = Math.sqrt(distSq);
          
          // Coulomb force: F = k * q1 * q2 / r²
          const force = electricFieldStrength * this.charge * electrode.charge / distSq * 10000;
          
          fx += force * dx / dist;
          fy += force * dy / dist;
        });
        
        // Magnetic force (Lorentz force): F = q(v × B)
        if (magneticFieldStrength > 0) {
          const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
          if (speed > 0) {
            // Simplified magnetic field (uniform in z-direction)
            const magneticForce = this.charge * magneticFieldStrength * speed * 0.001;
            
            // Perpendicular force
            const perpX = -this.vy / speed;
            const perpY = this.vx / speed;
            
            fx += magneticForce * perpX;
            fy += magneticForce * perpY;
          }
        }
        
        // Apply forces (F = ma)
        const acceleration = 0.01 / this.mass; // scaled
        this.vx += fx * acceleration;
        this.vy += fy * acceleration;
        
        // Thermal motion and collisions
        if (Math.random() < 0.01) {
          const thermalBoost = this.thermalVelocity * 0.0001;
          this.vx += (Math.random() - 0.5) * thermalBoost;
          this.vy += (Math.random() - 0.5) * thermalBoost;
        }
        
        // Particle-particle interactions (simplified)
        if (this.collisionCooldown <= 0) {
          this.handleCollisions();
        }
        
        // Energy damping (simulating collisions with neutral atoms)
        this.vx *= 0.9995;
        this.vy *= 0.9995;
        
        // Update position
        this.x += this.vx;
        this.y += this.vy;
        
        // Boundary conditions (reflecting walls)
        if (this.x < 0 || this.x > canvas.width) {
          this.vx *= -0.8;
          this.x = Math.max(0, Math.min(canvas.width, this.x));
        }
        if (this.y < 0 || this.y > canvas.height) {
          this.vy *= -0.8;
          this.y = Math.max(0, Math.min(canvas.height, this.y));
        }
        
        // Update trail
        this.updateTrail();
        
        // Update kinetic energy
        this.kineticEnergy = 0.5 * this.mass * (this.vx * this.vx + this.vy * this.vy);
      }
      
      handleCollisions() {
        particles.forEach(other => {
          if (other === this || !other.active) return;
          
          const dx = this.x - other.x;
          const dy = this.y - other.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          
          if (dist < (this.type.size + other.type.size) * 2) {
            // Elastic collision (simplified)
            const angle = Math.atan2(dy, dx);
            const speed1 = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
            const speed2 = Math.sqrt(other.vx * other.vx + other.vy * other.vy);
            
            // Exchange some momentum
            const momentum1 = this.mass * speed1;
            const momentum2 = other.mass * speed2;
            
            const newSpeed1 = (momentum1 - momentum2) / (this.mass + other.mass) + momentum2 / this.mass;
            const newSpeed2 = (momentum2 - momentum1) / (this.mass + other.mass) + momentum1 / other.mass;
            
            this.vx = Math.cos(angle) * newSpeed1 * 0.5;
            this.vy = Math.sin(angle) * newSpeed1 * 0.5;
            
            other.vx = -Math.cos(angle) * newSpeed2 * 0.5;
            other.vy = -Math.sin(angle) * newSpeed2 * 0.5;
            
            this.collisionCooldown = 30;
            other.collisionCooldown = 30;
          }
        });
      }
      
      updateTrail() {
        this.trail.push({ x: this.x, y: this.y, time: time });
        
        // Limit trail length
        if (this.trail.length > 20) {
          this.trail.shift();
        }
      }
      
      draw() {
        // Draw trail
        if (this.trail.length > 1) {
          ctx.strokeStyle = this.type.color;
          ctx.lineWidth = 1;
          ctx.globalAlpha = 0.3;
          
          ctx.beginPath();
          ctx.moveTo(this.trail[0].x, this.trail[0].y);
          
          for (let i = 1; i < this.trail.length; i++) {
            ctx.lineTo(this.trail[i].x, this.trail[i].y);
          }
          
          ctx.stroke();
          ctx.globalAlpha = 1.0;
        }
        
        // Draw particle
        const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
        const size = this.type.size * (1 + speed * 0.01);
        
        // Glow effect based on kinetic energy
        const glow = ctx.createRadialGradient(
          this.x, this.y, 0,
          this.x, this.y, size * 3
        );
        glow.addColorStop(0, this.type.color);
        glow.addColorStop(1, 'rgba(0, 0, 0, 0)');
        
        ctx.fillStyle = glow;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size * 3, 0, Math.PI * 2);
        ctx.fill();
        
        // Core particle
        ctx.fillStyle = this.type.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
        ctx.fill();
        
        // Charge indicator
        ctx.fillStyle = '#ffffff';
        ctx.font = '8px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(this.charge > 0 ? '+' : '−', this.x, this.y + 2);
      }
    }
    
    // Electrode class
    class Electrode {
      constructor(x, y, charge = 1) {
        this.x = x;
        this.y = y;
        this.charge = charge;
        this.size = 15;
      }
      
      draw() {
        // Electrode body
        const gradient = ctx.createRadialGradient(
          this.x, this.y, 0,
          this.x, this.y, this.size
        );
        
        if (this.charge > 0) {
          gradient.addColorStop(0, '#ff6666');
          gradient.addColorStop(1, '#cc3333');
        } else {
          gradient.addColorStop(0, '#6666ff');
          gradient.addColorStop(1, '#3333cc');
        }
        
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        
        // Electrode outline
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.stroke();
        
        // Charge indicator
        ctx.fillStyle = '#ffffff';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(this.charge > 0 ? '+' : '−', this.x, this.y + 4);
      }
    }
    
    // Generate plasma particles
    function generatePlasma() {
      particles = [];
      
      for (let i = 0; i < particleDensity; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        
        // Thermal velocity distribution (Maxwell-Boltzmann approximation)
        const thermalSpeed = Math.sqrt(3 * k_B * plasmaTemperature / (1.661e-27)) * 0.0001; // scaled
        const angle = Math.random() * Math.PI * 2;
        const speed = thermalSpeed * (0.5 + Math.random());
        
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        
        // Particle type distribution (mostly electrons and protons)
        let type;
        const rand = Math.random();
        if (rand < 0.45) {
          type = plasmaParticleTypes.electron;
        } else if (rand < 0.9) {
          type = plasmaParticleTypes.proton;
        } else if (rand < 0.97) {
          type = plasmaParticleTypes.alpha;
        } else {
          type = plasmaParticleTypes.heavyIon;
        }
        
        particles.push(new PlasmaParticle(x, y, vx, vy, type));
      }
    }
    
    // Draw electric field lines
    function drawFieldLines() {
      if (!showFieldLines || electrodes.length === 0) return;
      
      ctx.strokeStyle = 'rgba(102, 204, 255, 0.4)';
      ctx.lineWidth = 1;
      
      // Draw field lines from positive electrodes
      electrodes.filter(e => e.charge > 0).forEach(electrode => {
        for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 8) {
          let x = electrode.x;
          let y = electrode.y;
          
          ctx.beginPath();
          ctx.moveTo(x, y);
          
          // Trace field line
          for (let step = 0; step < 100; step++) {
            let fx = 0, fy = 0;
            
            electrodes.forEach(other => {
              const dx = x - other.x;
              const dy = y - other.y;
              const distSq = dx * dx + dy * dy + 100;
              const dist = Math.sqrt(distSq);
              
              const force = other.charge / distSq;
              fx += force * dx / dist;
              fy += force * dy / dist;
            });
            
            const fieldMag = Math.sqrt(fx * fx + fy * fy);
            if (fieldMag > 0) {
              fx /= fieldMag;
              fy /= fieldMag;
            }
            
            x += fx * 5;
            y += fy * 5;
            
            if (x < 0 || x > canvas.width || y < 0 || y > canvas.height) break;
            
            ctx.lineTo(x, y);
          }
          
          ctx.stroke();
        }
      });
    }
    
    // Create magnetic bottle configuration
    function createMagneticBottle() {
      magneticSources = [
        { x: cx - 200, y: cy, strength: 1 },
        { x: cx + 200, y: cy, strength: 1 },
        { x: cx - 100, y: cy - 100, strength: -0.5 },
        { x: cx + 100, y: cy - 100, strength: -0.5 },
        { x: cx - 100, y: cy + 100, strength: -0.5 },
        { x: cx + 100, y: cy + 100, strength: -0.5 }
      ];
    }
    
    // Create tokamak configuration
    function createTokamak() {
      magneticSources = [];
      for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2;
        const radius = 250;
        magneticSources.push({
          x: cx + Math.cos(angle) * radius,
          y: cy + Math.sin(angle) * radius,
          strength: 1
        });
      }
    }
    
    // Calculate plasma properties
    function calculatePlasmaProperties() {
      if (particles.length === 0) return;
      
      let totalVelocity = 0;
      let totalKineticEnergy = 0;
      let electronDensity = 0;
      
      particles.forEach(particle => {
        const speed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
        totalVelocity += speed;
        totalKineticEnergy += particle.kineticEnergy;
        
        if (particle.charge < 0) electronDensity++;
      });
      
      const avgVelocity = totalVelocity / particles.length * 1000; // convert to km/s
      const avgKineticEnergy = totalKineticEnergy / particles.length;
      
      // Plasma frequency (simplified)
      const n_e = electronDensity / (canvas.width * canvas.height) * 1e15; // electrons/m³
      const plasmaFreq = Math.sqrt(n_e * eV_to_J / (m_e * 8.854e-12)) / (2 * Math.PI) / 1e6; // MHz
      
      // Debye length (simplified)
      const debyeLength = Math.sqrt(8.854e-12 * k_B * plasmaTemperature / (n_e * eV_to_J)) * 1e6; // μm
      
      // Update display
      document.getElementById('particleCount').textContent = particles.length;
      document.getElementById('avgVelocity').textContent = avgVelocity.toFixed(1);
      document.getElementById('plasmaFreq').textContent = plasmaFreq.toFixed(2);
      document.getElementById('debyeLength').textContent = debyeLength.toFixed(1);
      document.getElementById('tempDisplay').textContent = plasmaTemperature.toLocaleString();
    }
    
    // Mouse event handlers
    canvas.addEventListener('mousedown', (e) => {
      mouseDown = true;
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
      
      if (electrodeMode) {
        // Add electrode with alternating charge
        const charge = electrodes.length % 2 === 0 ? 1 : -1;
        electrodes.push(new Electrode(mouseX, mouseY, charge));
      }
    });
    
    canvas.addEventListener('mouseup', () => {
      mouseDown = false;
    });
    
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
    });
    
    // Control event listeners
    document.getElementById('pauseBtn').addEventListener('click', () => {
      isAnimating = !isAnimating;
      document.getElementById('pauseBtn').textContent = isAnimating ? 'Pause' : 'Resume';
      if (isAnimating) animate();
    });
    
    document.getElementById('clearBtn').addEventListener('click', () => {
      particles = [];
    });
    
    document.getElementById('ionizeBtn').addEventListener('click', () => {
      generatePlasma();
    });
    
    document.getElementById('addElectrodeBtn').addEventListener('click', () => {
      electrodeMode = true;
      document.getElementById('addElectrodeBtn').classList.add('active');
    });
    
    document.getElementById('clearElectrodesBtn').addEventListener('click', () => {
      electrodes = [];
    });
    
    document.getElementById('magneticBottleBtn').addEventListener('click', () => {
      createMagneticBottle();
    });
    
    document.getElementById('tokamakBtn').addEventListener('click', () => {
      createTokamak();
    });
    
    document.getElementById('clearMagneticBtn').addEventListener('click', () => {
      magneticSources = [];
    });
    
    // Slider controls
    const controls = [
      { id: 'particleDensity', variable: 'particleDensity', display: 'particleDensityValue' },
      { id: 'temperature', variable: 'plasmaTemperature', display: 'temperatureValue', format: v => v + 'K' },
      { id: 'fieldStrength', variable: 'electricFieldStrength', display: 'fieldStrengthValue', scale: 0.01 },
      { id: 'magneticField', variable: 'magneticFieldStrength', display: 'magneticFieldValue', scale: 0.01 }
    ];
    
    controls.forEach(control => {
      const slider = document.getElementById(control.id);
      const display = document.getElementById(control.display);
      
      slider.addEventListener('input', () => {
        const value = parseFloat(slider.value);
        window[control.variable] = control.scale ? value * control.scale : value;
        display.textContent = control.format ? control.format(value) : value;
        
        if (control.variable === 'particleDensity') {
          generatePlasma();
        }
      });
    });
    
    document.getElementById('showFieldLines').addEventListener('change', (e) => {
      showFieldLines = e.target.checked;
    });
    
    // Animation loop
    function animate() {
      time++;
      
      // Clear canvas with plasma background
      const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(canvas.width, canvas.height));
      gradient.addColorStop(0, '#001122');
      gradient.addColorStop(1, '#000811');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw electric field lines
      drawFieldLines();
      
      // Draw electrodes
      electrodes.forEach(electrode => electrode.draw());
      
      // Update and draw particles
      particles = particles.filter(particle => {
        particle.update();
        particle.draw();
        return particle.active;
      });
      
      // Calculate and display plasma properties
      calculatePlasmaProperties();
      
      // Continue animation
      if (isAnimating) {
        animationId = requestAnimationFrame(animate);
      }
    }
    
    // Initialize
    generatePlasma();
    
    // Start with some initial electrodes
    electrodes.push(new Electrode(200, cy, 1));
    electrodes.push(new Electrode(canvas.width - 200, cy, -1));
    
    // Start animation
    animate();
  </script>
</body>
</html>